<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>OptiQuÃªte Vision Claire</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  .pupil {
Â  Â  Â  Â  Â  Â  background: radial-gradient(circle, #1a1a2e 0%, #16213e 70%, #0f3460 100%);
Â  Â  Â  Â  Â  Â  box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
Â  Â  Â  Â  }
Â  Â  Â  Â  .retina {
Â  Â  Â  Â  Â  Â  filter: blur(50px);
Â  Â  Â  Â  Â  Â  transition: filter 0.5s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lens-control {
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lens-control:hover {
Â  Â  Â  Â  Â  Â  transform: scale(1.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  .lens-control:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  }
Â  Â  Â  Â  .diagnostic-radio {
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  background-color: rgba(75, 85, 99, 0.5);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .diagnostic-radio:hover {
Â  Â  Â  Â  Â  Â  background-color: rgba(55, 65, 81, 0.7);
Â  Â  Â  Â  }
Â  Â  Â  Â  input[type="radio"]:checked + label {
Â  Â  Â  Â  Â  Â  background-color: #4f46e5;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  button:disabled {
Â  Â  Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  Â  Â  button:disabled:hover {
Â  Â  Â  Â  Â  Â  transform: none;
Â  Â  Â  Â  Â  Â  background-color: #3b82f6;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 to-purple-900 min-h-screen text-white">
Â  Â  <div id="vanta-bg" class="fixed inset-0 z-0"></div>
Â  Â Â 
Â  Â  <div class="relative z-10 container mx-auto px-4 py-12">
Â  Â  Â  Â  <header class="text-center mb-12">
Â  Â  Â  Â  Â  Â  <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300">ğŸ‘ï¸ OptiQuÃªte Vision Claire</h1>
Â  Â  Â  Â  Â  Â  <p class="text-xl text-blue-200">Testez vos compÃ©tences en optomÃ©trie avec des patients virtuels !</p>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <div class="max-w-4xl mx-auto bg-gray-800 bg-opacity-70 backdrop-blur-lg rounded-xl p-6 shadow-2xl border border-purple-400 border-opacity-30">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col lg:flex-row gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 flex flex-col items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative w-64 h-64 rounded-full overflow-hidden pupil mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="retina" class="retina absolute inset-0 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-8xl font-bold opacity-90">E</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl mb-2">Puissance Actuelle :</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="current-lens" class="text-3xl font-bold mb-6">0.00 Î´</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-semibold mb-4 text-purple-200">DÃ©tails du Patient</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-700 bg-opacity-50 p-3 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-blue-200">ID Patient</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="patient-id" class="text-lg">#0000</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-700 bg-opacity-50 p-3 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-blue-200">Correction Requise</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="required-correction" class="text-lg">???.?? Î´</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-semibold mb-4 text-purple-200">ContrÃ´les de la Lentille</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-3 gap-3 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(1)" class="lens-control bg-blue-600 hover:bg-blue-500 p-4 rounded-lg font-bold text-xl">+1.00</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(0.5)" class="lens-control bg-blue-600 hover:bg-blue-500 p-4 rounded-lg font-bold text-xl">+0.50</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(0.25)" class="lens-control bg-blue-600 hover:bg-blue-500 p-4 rounded-lg font-bold text-xl">+0.25</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(-1)" class="lens-control bg-purple-600 hover:bg-purple-500 p-4 rounded-lg font-bold text-xl">-1.00</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(-0.5)" class="lens-control bg-purple-600 hover:bg-purple-500 p-4 rounded-lg font-bold text-xl">-0.50</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustLens(-0.25)" class="lens-control bg-purple-600 hover:bg-purple-500 p-4 rounded-lg font-bold text-xl">-0.25</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="resetLens()" class="w-full bg-gray-600 hover:bg-gray-500 p-3 rounded-lg mb-4 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="refresh-cw" class="inline mr-2"></i> RÃ©initialiser
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="diagnose-btn" onclick="requestDiagnostic()" class="w-full bg-blue-700 hover:bg-blue-600 p-3 rounded-lg mb-4 flex items-center justify-center font-bold" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="edit" class="inline mr-2"></i> Poser le diagnostic
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="newPatient()" class="w-full bg-green-600 hover:bg-green-500 p-3 rounded-lg flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="user-plus" class="inline mr-2"></i> Nouveau Patient
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="mt-12 text-center text-blue-200">
Â  Â  Â  Â  Â  Â  <p>Score : <span id="score" class="font-bold">0</span> diagnostics corrects</p>
Â  Â  Â  Â  Â  Â  <button onclick="downloadResults()" class="mt-4 bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-lg text-sm flex items-center justify-center mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="download" class="inline mr-2 h-4 w-4"></i> TÃ©lÃ©charger les rÃ©sultats (CSV)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
Â  Â  Â  Â  <div class="bg-gradient-to-br from-green-600 to-blue-600 p-8 rounded-xl max-w-md text-center">
Â  Â  Â  Â  Â  Â  <i data-feather="check-circle" class="w-16 h-16 mx-auto text-white mb-4"></i>
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-4">Vision Parfaite !</h3>
Â  Â  Â  Â  Â  Â  <p id="success-message" class="text-lg mb-6">"Je vois clairement maintenant ! Merci docteur !"</p>
Â  Â  Â  Â  Â  Â  <button onclick="openDiagnosticModal()" class="bg-white text-green-700 px-6 py-2 rounded-lg font-bold">Continuer vers le diagnostic</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="diagnostic-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
Â  Â  Â  Â  <div class="bg-gray-800 bg-opacity-90 backdrop-blur-lg rounded-xl p-8 max-w-lg text-center w-full">
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-6 text-purple-200">Quel est votre diagnostic ?</h3>
Â  Â  Â  Â  Â  Â  <div id="diagnostic-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-4 gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-right font-semibold text-blue-200">Myopie</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="myopie-legere" id="d1" class="hidden"><label for="d1" class="diagnostic-radio block">LÃ©gÃ¨re</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="myopie-moyenne" id="d2" class="hidden"><label for="d2" class="diagnostic-radio block">Moyenne</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="myopie-severe" id="d3" class="hidden"><label for="d3" class="diagnostic-radio block">SÃ©vÃ¨re</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-4 gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-right font-semibold text-blue-200">HypermÃ©tropie</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="hypermetropie-legere" id="d4" class="hidden"><label for="d4" class="diagnostic-radio block">LÃ©gÃ¨re</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="hypermetropie-moyenne" id="d5" class="hidden"><label for="d5" class="diagnostic-radio block">Moyenne</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="radio" name="diagnostic" value="hypermetropie-severe" id="d6" class="hidden"><label for="d6" class="diagnostic-radio block">SÃ©vÃ¨re</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-4 gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-right font-semibold text-blue-200"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-span-3"><input type="radio" name="diagnostic" value="vision-normale" id="d7" class="hidden"><label for="d7" class="diagnostic-radio block">Vision Normale (EmmÃ©tropie)</label></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-gray-600 pt-4 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-blue-200 mb-2">Type de lentille correctrice</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" name="lens-type" value="convergente" id="lt1" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="lt1" class="diagnostic-radio block px-6">Convergente</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" name="lens-type" value="divergente" id="lt2" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="lt2" class="diagnostic-radio block px-6">Divergente</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="diagnostic-feedback" class="mt-4 h-6"></p>
Â  Â  Â  Â  Â  Â  <button onclick="checkDiagnostic()" class="mt-4 bg-indigo-600 hover:bg-indigo-500 px-8 py-3 rounded-lg font-bold">Valider le Diagnostic</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
Â  Â  <script>
     /*
 * =============================================================
 * Application Ã‰ducative : OptiQuÃªte Vision Claire
 * Auteur: Mathieu Dubreuil
 * GitHub: [https://github.com/dubrma1/Experiences-virtuelles-au-CSSMB]
 * Licence: MIT 
  * Description: Simulation d'optomÃ©trie pour tester les corrections visuelles.
 * =============================================================
 */
Â  Â  Â  Â  // Message de signature dans la console
Â  Â  Â  Â  (function() {
Â  Â  Â  Â  Â  Â  const styles = [
Â  Â  Â  Â  Â  Â  Â  Â  'color: #007BFF',
Â  Â  Â  Â  Â  Â  Â  Â  'font-size: 1.1em',
Â  Â  Â  Â  Â  Â  Â  Â  'font-weight: bold',
Â  Â  Â  Â  Â  Â  Â  Â  'background-color: #f0f0f0',
Â  Â  Â  Â  Â  Â  Â  Â  'padding: 4px 8px',
Â  Â  Â  Â  Â  Â  Â  Â  'border-radius: 4px'
Â  Â  Â  Â  Â  Â  ].join(';');

Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  '%cApplication crÃ©Ã©e par Mathieu Dubreuil',Â 
Â  Â  Â  Â  Â  Â  Â  Â  styles
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  console.log('Code source disponible sur GitHub : [https://github.com/dubrma1/Experiences-virtuelles-au-CSSMB]');
Â  Â  Â  Â  })();

Â  Â  Â  Â  let currentLens = 0;
Â  Â  Â  Â  let requiredCorrection = 0;
Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  let currentPatient = 1;
Â  Â  Â  Â  let diagnosticResults = [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  VANTA.GLOBE({ el: "#vanta-bg", mouseControls: true, touchControls: true, gyroControls: false, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, color: 0x5e6fff, backgroundColor: 0x0, size: 0.8 });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  feather.replace();
Â  Â  Â  Â  Â  Â  generateNewPatient();
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  function generateNewPatient() {
Â  Â  Â  Â  Â  Â  let steps = Math.floor(Math.random() * 65) - 32;
Â  Â  Â  Â  Â  Â  requiredCorrection = steps * 0.25;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('patient-id').textContent = `#${currentPatient.toString().padStart(4, '0')}`;
Â  Â  Â  Â  Â  Â  document.getElementById('required-correction').textContent = '???.?? Î´';
Â  Â  Â  Â  Â  Â  document.getElementById('diagnose-btn').disabled = true;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  resetLens();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function adjustLens(adjustment) {
Â  Â  Â  Â  Â  Â  currentLens = Math.max(-10, Math.min(10, currentLens + adjustment));
Â  Â  Â  Â  Â  Â  currentLens = parseFloat(currentLens.toFixed(2));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('current-lens').textContent = `${currentLens >= 0 ? '+' : ''}${currentLens.toFixed(2)} Î´`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const difference = Math.abs(requiredCorrection - currentLens);
Â  Â  Â  Â  Â  Â  const blurAmount = Math.min(50, difference * 10);
Â  Â  Â  Â  Â  Â  document.getElementById('retina').style.filter = `blur(${blurAmount}px)`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (Math.abs(requiredCorrection - currentLens) < 0.01) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('diagnose-btn').disabled = false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('diagnose-btn').disabled = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function resetLens() {
Â  Â  Â  Â  Â  Â  currentLens = 0;
Â  Â  Â  Â  Â  Â  document.getElementById('current-lens').textContent = '0.00 Î´';
Â  Â  Â  Â  Â  Â  document.getElementById('retina').style.filter = 'blur(50px)';
Â  Â  Â  Â  Â  Â  document.getElementById('diagnose-btn').disabled = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  function requestDiagnostic() {
Â  Â  Â  Â  Â  Â  showSuccess();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showSuccess() {
Â  Â  Â  Â  Â  Â  document.getElementById('required-correction').textContent = `${requiredCorrection >= 0 ? '+' : ''}${requiredCorrection.toFixed(2)} Î´`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const messages = ["Je vois clairement maintenant ! Merci docteur !", "Le monde est si net ! Travail incroyable !", "Tout est net maintenant. Vous Ãªtes brillant !"];
Â  Â  Â  Â  Â  Â  document.getElementById('success-message').textContent = `"${messages[Math.floor(Math.random() * messages.length)]}"`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('success-modal').classList.remove('hidden');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function openDiagnosticModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('success-modal').classList.add('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const diagRadios = document.getElementsByName('diagnostic');
Â  Â  Â  Â  Â  Â  for (let i = 0; i < diagRadios.length; i++) diagRadios[i].checked = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // RÃ©initialiser aussi les boutons du type de lentille
Â  Â  Â  Â  Â  Â  const lensRadios = document.getElementsByName('lens-type');
Â  Â  Â  Â  Â  Â  for (let i = 0; i < lensRadios.length; i++) lensRadios[i].checked = false;

Â  Â  Â  Â  Â  Â  document.getElementById('diagnostic-feedback').textContent = '';
Â  Â  Â  Â  Â  Â  document.getElementById('diagnostic-modal').classList.remove('hidden');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getCorrectDiagnosis(correction) {
Â  Â  Â  Â  Â  Â  const absCorrection = Math.abs(correction);
Â  Â  Â  Â  Â  Â  if (correction < -0.24) {
Â  Â  Â  Â  Â  Â  Â  Â  if (absCorrection <= 2.00) return 'myopie-legere';
Â  Â  Â  Â  Â  Â  Â  Â  if (absCorrection <= 5.00) return 'myopie-moyenne';
Â  Â  Â  Â  Â  Â  Â  Â  return 'myopie-severe';
Â  Â  Â  Â  Â  Â  } else if (correction > 0.24) {
Â  Â  Â  Â  Â  Â  Â  Â  if (absCorrection <= 2.00) return 'hypermetropie-legere';
Â  Â  Â  Â  Â  Â  Â  Â  if (absCorrection <= 5.00) return 'hypermetropie-moyenne';
Â  Â  Â  Â  Â  Â  Â  Â  return 'hypermetropie-severe';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  return 'vision-normale';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function checkDiagnostic() {
Â  Â  Â  Â  Â  Â  const selectedRadio = document.querySelector('input[name="diagnostic"]:checked');
Â  Â  Â  Â  Â  Â  if (!selectedRadio) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('diagnostic-feedback').textContent = "Veuillez sÃ©lectionner un diagnostic.";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('diagnostic-feedback').style.color = '#f87171';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Capturer le choix du type de lentille
Â  Â  Â  Â  Â  Â  const selectedLensRadio = document.querySelector('input[name="lens-type"]:checked');
Â  Â  Â  Â  Â  Â  const userLensType = selectedLensRadio ? selectedLensRadio.value : "non sÃ©lectionnÃ©";

Â  Â  Â  Â  Â  Â  const userDiagnosis = selectedRadio.value;
Â  Â  Â  Â  Â  Â  const correctDiagnosis = getCorrectDiagnosis(requiredCorrection);
Â  Â  Â  Â  Â  Â  const isCorrect = userDiagnosis === correctDiagnosis;
Â  Â  Â  Â  Â  Â  const feedbackEl = document.getElementById('diagnostic-feedback');

Â  Â  Â  Â  Â  Â  // Ajouter le type de lentille Ã  l'objet des rÃ©sultats
Â  Â  Â  Â  Â  Â  diagnosticResults.push({
Â  Â  Â  Â  Â  Â  Â  Â  patientId: `#${currentPatient.toString().padStart(4, '0')}`,
Â  Â  Â  Â  Â  Â  Â  Â  requiredCorrection: `${requiredCorrection.toFixed(2)} Î´`,
Â  Â  Â  Â  Â  Â  Â  Â  userDiagnosis: userDiagnosis.replace('-', ' '),
Â  Â  Â  Â  Â  Â  Â  Â  userLensType: userLensType, // NOUVELLE LIGNE
Â  Â  Â  Â  Â  Â  Â  Â  correctDiagnosis: correctDiagnosis.replace('-', ' '),
Â  Â  Â  Â  Â  Â  Â  Â  result: isCorrect ? "Correct" : "Incorrect"
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (isCorrect) {
Â  Â  Â  Â  Â  Â  Â  Â  feedbackEl.textContent = "Correct ! Passage au patient suivant...";
Â  Â  Â  Â  Â  Â  Â  Â  feedbackEl.style.color = '#4ade80';
Â  Â  Â  Â  Â  Â  Â  Â  score++;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('score').textContent = score;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  feedbackEl.textContent = `Incorrect. Le bon diagnostic Ã©tait : ${correctDiagnosis.replace('-', ' ')}.`;
Â  Â  Â  Â  Â  Â  Â  Â  feedbackEl.style.color = '#f87171';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('diagnostic-modal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  currentPatient++;
Â  Â  Â  Â  Â  Â  Â  Â  generateNewPatient();
Â  Â  Â  Â  Â  Â  }, isCorrect ? 1500 : 2500);
Â  Â  Â  Â  }

Â  Â  Â  Â  function downloadResults() {
Â  Â  Â  Â  Â  Â  if (diagnosticResults.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Aucun diagnostic n'a encore Ã©tÃ© enregistrÃ©.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let csvContent = "data:text/csv;charset=utf-8,";
Â  Â  Â  Â  Â  Â  // Ajouter le nouvel en-tÃªte pour le CSV
Â  Â  Â  Â  Â  Â  const headers = ["ID Patient", "Correction Requise", "Diagnostic Utilisateur", "Type de Lentille (Utilisateur)", "Diagnostic Correct", "RÃ©sultat"];
Â  Â  Â  Â  Â  Â  csvContent += headers.join(",") + "\r\n";

Â  Â  Â  Â  Â  Â  diagnosticResults.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  // Ajouter la nouvelle donnÃ©e Ã  la ligne du CSV
Â  Â  Â  Â  Â  Â  Â  Â  let rowArray = [row.patientId, row.requiredCorrection, row.userDiagnosis, row.userLensType, row.correctDiagnosis, row.result];
Â  Â  Â  Â  Â  Â  Â  Â  csvContent += rowArray.join(",") + "\r\n";
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const encodedUri = encodeURI(csvContent);
Â  Â  Â  Â  Â  Â  const link = document.createElement("a");
Â  Â  Â  Â  Â  Â  link.setAttribute("href", encodedUri);
Â  Â  Â  Â  Â  Â  link.setAttribute("download", "resultats_diagnostic.csv");
Â  Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  Â  link.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  }

Â  Â  Â  Â  function newPatient() {
Â  Â  Â  Â  Â  Â  currentPatient++;
Â  Â  Â  Â  Â  Â  generateNewPatient();
Â  Â  Â  Â  }
Â  Â 
// Message de signature dans la console
Â  Â  Â  Â  (function() {
Â  Â  Â  Â  Â  Â  const styles = [
Â  Â  Â  Â  Â  Â  Â  Â  'color: #007BFF',
Â  Â  Â  Â  Â  Â  Â  Â  'font-size: 1.1em',
Â  Â  Â  Â  Â  Â  Â  Â  'font-weight: bold',
Â  Â  Â  Â  Â  Â  Â  Â  'background-color: #f0f0f0',
Â  Â  Â  Â  Â  Â  Â  Â  'padding: 4px 8px',
Â  Â  Â  Â  Â  Â  Â  Â  'border-radius: 4px'
Â  Â  Â  Â  Â  Â  ].join(';');

Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  '%cApplication crÃ©Ã©e par Mathieu Dubreuil',Â 
Â  Â  Â  Â  Â  Â  Â  Â  styles
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  console.log('Code source disponible sur GitHub : [https://github.com/dubrma1/Experiences-virtuelles-au-CSSMB]');
Â  Â  Â  Â  })();

Â  Â  </script>
</body>
</html>
